<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>HLTV Stats</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>
    <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
          apiKey: "AIzaSyDrHFGN50kcJtRFBkw89yedrmTw7fhxXrE",
          authDomain: "hltvstats-20d23.firebaseapp.com",
          databaseURL: "https://hltvstats-20d23.firebaseio.com",
          projectId: "hltvstats-20d23",
          storageBucket: "hltvstats-20d23.appspot.com",
          messagingSenderId: "626499430202"
        };
        firebase.initializeApp(config);
      </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript">
      $.urlParam = function(name){
          var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
          if (results==null) {
            return null;
          }
          return decodeURI(results[1]) || 0;
      }
      $(function() {
        const date = new Date().toDateString();
        const database = firebase.database();
        database.ref('home/' + date).once('value', (snapshot) => {
          const data = snapshot.val();
          if (data) {
            $('#status').html(''); // clear the HTML
            Object.keys(data).forEach((name) => {
              if (data[name].name == "") {
                $('#status').append('<h5>' + name.substr(0, name.indexOf('GMT')) + 'by Anonymous' + '</h5>' + '<h6>' + data[name].comment + '</h6>');
              } else {
                $('#status').append('<h5>' + name.substr(0, name.indexOf('GMT')) + 'by ' + data[name].name + '</h5>' + '<h6>' + data[name].comment + '</h6>');
              }
          })
          }
        })
        database.ref('home/' + date).on('value', (snapshot) => {
          const data = snapshot.val();
          if (data) {
            $('#status').html(''); // clear the HTML
            Object.keys(data).forEach((name) => {
              if (data[name].name == "") {
                $('#status').append('<h5>' + name.substr(0, name.indexOf('GMT')) + 'by Anonymous' + '</h5>' + '<h6>' + data[name].comment + '</h6>');
              } else {
                $('#status').append('<h5>' + name.substr(0, name.indexOf('GMT')) + 'by ' + data[name].name + '</h5>' + '<h6>' + data[name].comment + '</h6>');
              }
          })
          }
        });
        $('#insertButton').click(() => {
          if ( $('#commentInput').val() !== '') {
            database.ref('home/' + date + '/' + new Date()).set({
            name: $('#nameInput').val(),
            comment: $('#commentInput').val()
          })
          }
        })
      });
    </script>
  </head>
  <body>
    <fieldset>
        <h1 align="center"> CS:GO Match Stats & Analysis </h1>
        <h5 align="center"> Designed to be a lightweight, ad-free CS:GO match analysis engine powered by HLTV </h5>
        <div class="container">
            <form action="/matches" method="post">
                <div class="fields" align="center">
                    <label for="teamname"> Filter by team: </label>
                    <input type="text" name="teamname">
                    <label for="eventname"> Filter by event: </label>
                    <input type="text" name="eventname">
                </div>
                <input type="submit" class="ghost-button" value="Find Matches">
            </form>
            <br>
            <form action="/matchresults" method="post">
                <div class="fields" align="center">
                    <label for="pages"> How many pages? </label>
                    <select id="pages" name="pages" align="center">
                        <% var options = []; %>
                        <option value="1" selected="selected">1 page (Default)</option>
                        <% for(var i = 2; i <= 5; i++) { %>
                            <option value='<%= i %>'><%= i %> pages </option>
                        <% } %>
                    </select>
                </div>
                <div class="fields" align="center">
                    <label for="teamname"> Filter by team: </label>
                    <input type="teamname" name="teamname">
                    <label for="eventname"> Filter by event: </label>
                    <input type="eventname" name="eventname">
                </div>
                <input type="submit" class="ghost-button" value="Find Match Results">
            </form>
        </div>
        <h4 align="center"> Today's Comments </h4>
        <div class="container">
        <div id="status" align="center"></div>
        <div class="fields" align="center">
            <label for="name"> Nickname: </label>
            <input type="text" id="nameInput" placeholder="Name (optional)" width="30%">
            <label for="comment"> Your comment: </label>
            <input type="text" id="commentInput" placeholder="Comment" width="30%">
        </div>
        <button class="ghost-button" id="insertButton">Submit Comment</button>
        </div>
        <% if (rankings != null) { %>
            <h3 align="center"> Best Players This Month </h3>
            <table id="playerRanking">
                <tr>
                    <th>Rank</th>
                    <th>Player</th>
                    <th>Rating</th>
                </tr>
                <% for(var i = 0; i < 30; i++) { %>
                    <tr>
                        <td><%= i + 1 %></td>
                        <td><%= rankings[i].name %></td>
                        <td><%= rankings[i].rating %></td>
                    </tr>
                <% } %>
            </table>
        <% } %>
    </fieldset>
</body>
</html>